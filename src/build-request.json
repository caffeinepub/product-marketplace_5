{
  "kind": "build_request",
  "title": "Fix image upload functionality and add image editing capability",
  "projectName": "Artisan Marketplace",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-74",
      "text": "Debug and fix the image upload mechanism in BatchUploader component to ensure images can be successfully uploaded to the backend blob storage when creating products in batch mode",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "make it functional, images upladable to store items"
        ]
      },
      "acceptanceCriteria": [
        "Users can select multiple image files in the BatchUploader component",
        "Selected images are successfully uploaded to the backend blob storage",
        "Upload progress is displayed to the user during the upload process",
        "Products are created with correct image references after successful upload",
        "Error messages are displayed if upload fails with actionable feedback"
      ]
    },
    {
      "id": "REQ-75",
      "text": "Debug and fix the image upload mechanism in SingleProductUploader component to ensure images can be successfully uploaded to the backend blob storage when creating individual products",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "make it functional, images upladable to store items"
        ]
      },
      "acceptanceCriteria": [
        "Users can select a single image file in the SingleProductUploader component",
        "Selected image is successfully uploaded to the backend blob storage",
        "Upload progress is displayed to the user during the upload process",
        "Product is created with correct image reference after successful upload",
        "Error messages are displayed if upload fails with actionable feedback"
      ]
    },
    {
      "id": "REQ-76",
      "text": "Verify that the backend blob storage functions correctly handle image data, store blobs with proper metadata, and return accessible URLs or blob IDs for frontend consumption",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "make it functional, images upladable to store items"
        ]
      },
      "acceptanceCriteria": [
        "Backend accepts image data in the correct format (Blob type)",
        "Images are stored in the backend with unique identifiers",
        "Backend returns valid blob IDs or URLs that frontend can use to display images",
        "Stored images persist across canister upgrades",
        "Authorization checks prevent unauthorized image uploads"
      ]
    },
    {
      "id": "REQ-77",
      "text": "Add image editing functionality allowing administrators to replace or update product images after initial upload in both SingleProductUploader and product management interfaces",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "editable"
        ]
      },
      "acceptanceCriteria": [
        "Administrators can select a new image file to replace an existing product image",
        "The new image is uploaded to backend blob storage",
        "The product record is updated with the new image reference",
        "Old image blob is properly handled (replaced or removed)",
        "Image update operation provides user feedback on success or failure"
      ]
    },
    {
      "id": "REQ-78",
      "text": "Add UI controls in ProductCard or a product management view that allow administrators to initiate image editing for existing products",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "editable"
        ]
      },
      "acceptanceCriteria": [
        "Edit button or icon is displayed on product cards for administrators",
        "Clicking edit opens an interface for selecting a new product image",
        "File input allows selecting image files from the user's device",
        "Upload progress is displayed during the image replacement operation",
        "Success confirmation is shown after successful image update"
      ]
    },
    {
      "id": "REQ-79",
      "text": "Create backend function updateProductImage that accepts a product ID and new image blob, replaces the existing image reference, and returns the updated product data",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "editable"
        ]
      },
      "acceptanceCriteria": [
        "Function accepts productId and new image Blob as parameters",
        "Function validates that the product exists before updating",
        "Function stores the new image blob and updates the product record",
        "Function is restricted to admin users only",
        "Function returns updated product data or appropriate error response"
      ]
    },
    {
      "id": "REQ-80",
      "text": "Create React Query hook useUpdateProductImage for updating product images with proper cache invalidation to ensure ProductGrid displays updated images immediately",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "editable"
        ]
      },
      "acceptanceCriteria": [
        "Hook wraps the backend updateProductImage function",
        "Hook invalidates products query cache after successful update",
        "Hook provides loading, error, and success states",
        "Hook integrates seamlessly with existing React Query patterns in useQueries.ts",
        "UI components can use the hook to trigger image updates"
      ]
    }
  ],
  "constraints": [
    "Do not change the single-actor backend architecture",
    "Do not modify immutable frontend paths: useInternetIdentity.ts, useInternetIdentity.tsx, useActor.ts, main.tsx, components/ui",
    "Maintain existing Stripe integration and payment flow",
    "Preserve existing category hierarchy and product data structures",
    "Keep blob storage mechanism within the main actor"
  ],
  "nonGoals": [
    "Implementing advanced image editing features like cropping or filters",
    "Supporting multiple images per product",
    "Adding image compression or optimization",
    "Implementing image galleries or lightbox views",
    "Adding bulk image editing operations"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}